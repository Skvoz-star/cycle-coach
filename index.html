<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Cycle Coach ‚Äî —à–ø–∞—Ä–≥–∞–ª–∫–∞ –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø–æ –¥–Ω—è–º —Ü–∏–∫–ª–∞</title>
  <!-- –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
<meta name="apple-mobile-web-app-title" content="Cycle Coach">

<!-- –í–∫–ª—é—á–∞–µ–º —Ä–µ–∂–∏–º –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–±–µ–∑ –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–∏) -->
<meta name="apple-mobile-web-app-capable" content="yes">

<!-- –°—Ç–∏–ª—å —Å—Ç–∞—Ç—É—Å-–±–∞—Ä–∞ (—Ü–≤–µ—Ç –∏ —Å–≤–µ—Ç/—Ç—ë–º–Ω–∞—è —Ç–µ–º–∞) -->
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<!-- –ò–∫–æ–Ω–∫–∞ –¥–ª—è –≥–ª–∞–≤–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ -->
<link rel="apple-touch-icon" href="icon.png">
  <link rel="manifest" href="manifest.json">
<style>
  :root{
    --bg:#0f1220;--card:#161a2b;--muted:#8b91a7;--text:#e8ebff;
    --accent:#6ea8ff;--good:#6ef3a5;--warn:#ffd36e;--love:#ff7aa2;
    --chip:#1e243c;--border:#2a3150;--shadow: 0 10px 30px rgba(0,0,0,.35);
    --radius:16px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    background: radial-gradient(1200px 600px at 10% -10%, #1b2050 0, transparent 60%),
                radial-gradient(800px 500px at 110% 10%, #2a1d4f 0, transparent 60%),
                var(--bg);
    color:var(--text);
    display:flex; align-items:stretch; justify-content:center; padding:24px;
  }
  .app{max-width:980px; width:100%}
  header{
    display:flex; align-items:center; justify-content:space-between; gap:16px; margin-bottom:16px;
  }
  .brand{display:flex; align-items:center; gap:14px}
  .logo{width:42px; height:42px; border-radius:10px; background:linear-gradient(135deg, #6ea8ff, #a28cff 60%, #ff7aa2);
        box-shadow: var(--shadow)}
  h1{font-size: clamp(20px, 2vw, 26px); margin:0}
  .sub{color:var(--muted); font-size:14px}
  .card{
    background: linear-gradient(180deg, rgba(255,255,255,.02), transparent 60%), var(--card);
    border:1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow);
    padding:18px; margin-bottom:18px;
  }
  .controls{display:grid; grid-template-columns: 1fr auto; gap:12px; align-items:end}
    label{font-size:14px;color:var(--muted);width: auto;display: block;margin-bottom: 10px;}
  input[type="number"]{
       text-align: center; padding:12px 14px; font-size:16px; color:var(--text);
    background:var(--chip); border:1px solid var(--border); border-radius:12px; outline:none;
  }
  input[type="number"]::-webkit-outer-spin-button,
  input[type="number"]::-webkit-inner-spin-button{ -webkit-appearance: none; margin: 0;}
  .btn{
    padding:12px 16px; border-radius:12px; border:1px solid var(--border);
    background:linear-gradient(180deg, rgba(110,168,255,.25), rgba(110,168,255,.1));
    color:var(--text); font-weight:600; cursor:pointer; transition: .15s transform ease, .15s opacity ease;
  }
  .btn:hover{transform: translateY(-1px)}
  .btn.secondary{background:var(--chip)}
  .grid{
    display:grid; gap:12px;
    grid-template-columns: repeat(6, 1fr);
  }
  .metric{
    background:var(--chip); border:1px solid var(--border); border-radius:14px; padding:12px;
  }
  .metric h3{margin:0 0 8px; font-size:14px; color:#b9c1dd; display:flex; justify-content:space-between; gap:8px}
  .score{font-variant-numeric: tabular-nums; font-weight:700}
  .bars{display:flex; gap:6px}
  .bar{height:12px; flex:1; border-radius:6px; background:#202844; border:1px solid #283155}
  .bar.on{background: linear-gradient(180deg, rgba(110,168,255,.9), rgba(110,168,255,.55)); border-color:#6ea8ff}
  .bar.on.good{background: linear-gradient(180deg, rgba(110,243,165,.9), rgba(110,243,165,.55)); border-color:#6ef3a5}
  .bar.on.warn{background: linear-gradient(180deg, rgba(255,211,110,.9), rgba(255,211,110,.55)); border-color:#ffd36e}
  .bar.on.love{background: linear-gradient(180deg, rgba(255,122,162,.9), rgba(255,122,162,.55)); border-color:#ff7aa2}
  .row{display:flex; gap:12px; flex-wrap:wrap}
  .chip{
    background:var(--chip); border:1px solid var(--border); border-radius:999px;
    padding:8px 12px; color:#b9c1dd; font-size:13px
  }
  .advice{
    display:grid; gap:14px; grid-template-columns: 1.2fr .8fr;
  }
  .advice .text{font-size:16px; line-height:1.55}
  .action{
    background: linear-gradient(180deg, rgba(255,122,162,.18), rgba(255,122,162,.08));
    border:1px solid #3a2a3a; border-radius:14px; padding:14px
  }
  .action h4{margin:0 0 8px}
  .action p{margin:0; color:#ffd6e3}
  .actions-row{display:flex; gap:10px; margin-top:10px}
  .tagline{color:#aeb6d5; font-size:13px}
  footer{margin-top:12px; color:var(--muted); font-size:12px; text-align:center}
  @media (max-width:840px){ .grid{grid-template-columns: repeat(2, 1fr)} .advice{grid-template-columns: 1fr} }
</style>
</head>
<body>
  <div class="app">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Cycle Coach</h1>
          <div class="sub">–®–ø–∞—Ä–≥–∞–ª–∫–∞ –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø–æ–¥ 28-–¥–Ω–µ–≤–Ω—ã–π —Ü–∏–∫–ª</div>
        </div>
      </div>
      <div class="tagline">¬´–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –¥–µ–Ω—å ‚Äî –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞–π–±¬ª</div>
    </header>

    <section class="card">
      <div class="controls">
        <div>
          <label for="day">–î–µ–Ω—å —Ü–∏–∫–ª–∞ (1‚Äì28)</label>
         
<div class="flex items-center space-x-3 justify-center my-4">
  <!-- –ö–Ω–æ–ø–∫–∞ –º–∏–Ω—É—Å -->
  <button id="minusDay" 
    class="btn">
    ‚àí
  </button>

  <!-- –ü–æ–ª–µ –≤–≤–æ–¥–∞ -->
   <input id="day" type="number" min="1" max="28" value="1" />

  <!-- –ö–Ω–æ–ø–∫–∞ –ø–ª—é—Å -->
  <button id="plusDay" 
    class="btn">
    +
  </button>
</div>
        </div>
        <div class="row">
          <button id="apply" class="btn">–ü–æ–∫–∞–∑–∞—Ç—å —à–ø–∞—Ä–≥–∞–ª–∫—É</button>
          <button id="shuffle" class="btn secondary" title="–û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ">–ï—â—ë –∏–¥–µ—è</button>
        </div>
      </div>
    </section>

    <section id="output" class="card" hidden>
      <div class="row" style="justify-content:space-between; align-items:center; margin-bottom:6px">
        <div class="chip" id="phaseChip">–§–∞–∑–∞</div>
        <div class="chip" id="vibeChip">–í–∞–π–± –¥–Ω—è</div>
      </div>

      <div class="grid" id="metricsGrid"></div>

      <div class="advice" style="margin-top:10px">
        <div class="text" id="adviceText"></div>
        <div class="action">
          <h4 style="display:flex;align-items:center;gap:8px; margin:0 0 6px">
            üéØ –ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
          </h4>
          <p id="actionText"></p>
          <div class="actions-row">
            <button id="another" class="btn secondary" style="padding:8px 12px">–î—Ä—É–≥–æ–µ</button>
            <button id="lock" class="btn secondary" style="padding:8px 12px">–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å</button>
          </div>
        </div>
      </div>
    </section>

    <footer>–î–∞–Ω–Ω—ã–µ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ ‚Äî –æ—Ä–∏–µ–Ω—Ç–∏—Ä—ã, –∞ –Ω–µ –ø—Ä–∏–≥–æ–≤–æ—Ä. –í—Å–µ–≥–¥–∞ —Å–ª—É—à–∞–π –µ—ë —Å–∏–≥–Ω–∞–ª—ã –∏ —Å–æ–≥–ª–∞—Å–∏–µ.</footer>
  </div>

<script>
/* ====== –î–ê–ù–ù–´–ï: –æ—Ü–µ–Ω–∫–∏ –ø–æ –¥–Ω—è–º (1‚Äì5) ====== */
const table = {
  // day: [–ì–æ–≤–æ—Ä–∏—Ç—å, –ó–∞–±–æ—Ç–∞, –û–±—ä—è—Ç–∏—è, –°—Ç—Ä–∞—Å—Ç—å, –ò–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞, –Æ–º–æ—Ä]
  1:[3,5,3,1,1,1], 2:[3,5,3,1,1,2], 3:[3,4,3,2,2,3], 4:[3,4,4,2,2,3], 5:[4,4,4,3,3,3],
  6:[5,3,3,3,3,4], 7:[5,3,3,3,3,4], 8:[5,3,5,3,5,5], 9:[5,3,5,4,5,5], 10:[5,3,5,4,5,5], 11:[5,3,5,4,5,5],
  12:[4,3,5,5,5,5], 13:[4,3,5,5,5,5],
  14:[4,3,5,5,5,4], 15:[3,3,5,5,5,3], 16:[3,3,5,5,5,3],
  17:[3,4,4,3,2,3], 18:[3,4,4,3,2,3], 19:[3,4,4,3,2,3], 20:[3,4,4,3,2,3],
  21:[2,5,4,2,2,2], 22:[2,5,4,2,2,2], 23:[2,5,4,2,2,2], 24:[2,4,5,2,2,2],
  25:[1,4,5,1,1,1], 26:[1,4,5,1,1,1], 27:[1,4,5,1,1,1], 28:[1,4,5,1,1,1]
};

const metricNames = ["–ì–æ–≤–æ—Ä–∏—Ç—å","–ó–∞–±–æ—Ç–∞","–û–±—ä—è—Ç–∏—è","–°—Ç—Ä–∞—Å—Ç—å","–ò–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞","–Æ–º–æ—Ä"];
const metricHints = {
  "–ì–æ–≤–æ—Ä–∏—Ç—å":"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤, –≤–æ–≤–ª–µ—á—ë–Ω–Ω–æ—Å—Ç—å –≤ –¥–∏–∞–ª–æ–≥",
  "–ó–∞–±–æ—Ç–∞":"–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–±–æ—Ç–∞, –ø–æ–º–æ—â—å, –≤–Ω–∏–º–∞–Ω–∏–µ –∫ –∫–æ–º—Ñ–æ—Ä—Ç—É",
  "–û–±—ä—è—Ç–∏—è":"–¢–µ–ª–µ—Å–Ω–∞—è –Ω–µ–∂–Ω–æ—Å—Ç—å –∏ –∫–æ–Ω—Ç–∞–∫—Ç",
  "–°—Ç—Ä–∞—Å—Ç—å":"–§–ª–∏—Ä—Ç/—Å–µ–∫—Å—É–∞–ª—å–Ω—ã–π —Ç–æ–Ω",
  "–ò–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞":"–í–µ–¥–µ–Ω–∏–µ –ø–ª–∞–Ω–æ–≤, —Ä–µ—à–µ–Ω–∏—è, –¥—Ä–∞–π–≤",
  "–Æ–º–æ—Ä":"–ò–≥—Ä–∏–≤–æ—Å—Ç—å, –ª—ë–≥–∫–æ—Å—Ç—å, —à—É—Ç–∫–∏"
};

/* ====== –§–ê–ó–´ –ò –í–ê–ô–ë ====== */
function phaseForDay(d){
  if (d>=1 && d<=5) return ["–ú–µ–Ω—Å—Ç—Ä—É–∞–ª—å–Ω–∞—è", "–±–æ–ª—å—à–µ –º—è–≥–∫–æ—Å—Ç–∏ –∏ —É—é—Ç–∞"];
  if (d>=6 && d<=13) return ["–§–æ–ª–ª–∏–∫—É–ª—è—Ä–Ω–∞—è", "—ç–Ω–µ—Ä–≥–∏—è –∏ –Ω–æ–≤–∏–∑–Ω–∞"];
  if (d>=14 && d<=16) return ["–û–≤—É–ª—è—Ü–∏—è", "–º–∞–∫—Å–∏–º—É–º —Å—Ç—Ä–∞—Å—Ç–∏ –∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏"];
  return ["–õ—é—Ç–µ–∏–Ω–æ–≤–∞—è", d>=25 ? "–ü–ú–°: –±–µ—Ä–µ–∂–Ω–æ—Å—Ç—å –∏ —Ç–µ—Ä–ø–µ–Ω–∏–µ" : "–¥–æ–º–∞—à–Ω–∏–π —É—é—Ç –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å"];
}

/* ====== –¢–ï–ö–°–¢ –°–û–í–ï–¢–ê –ü–û –î–ù–Æ ====== */
function adviceFor(day, scores){
  const [talk, care, hug, passion, init, humor] = scores;
  const parts = [];

  // –õ–∏–¥-—Å—Ç—Ä–æ–∫–∞
  const [ph, vibe] = phaseForDay(day);
  parts.push(`<b>${ph}</b>: ${vibe}.`);

  // –ú–∏–∫—Ä–æ-—Å–æ–≤–µ—Ç—ã –ø–æ –≤—ã—Å–æ–∫–∏–º/–Ω–∏–∑–∫–∏–º –º–µ—Ç—Ä–∏–∫–∞–º
  if (care>=4) parts.push("–°–¥–µ–ª–∞–π —É–ø–æ—Ä –Ω–∞ <b>–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫—É—é –∑–∞–±–æ—Ç—É</b> ‚Äî —Å–Ω–∏–º–∏ –±—ã—Ç–æ–≤—É—é –º–µ–ª–æ—á—å, –ø—Ä–µ–¥–ª–æ–∂–∏ –∫–æ–º—Ñ–æ—Ä—Ç.");
  if (hug>=4) parts.push("–ë–æ–ª—å—à–µ <b>–æ–±—ä—è—Ç–∏–π –∏ –Ω–µ–∂–Ω–æ—Å—Ç–∏</b> ‚Äî —Å–ø—Ä–æ—Å–∏ –ø—Ä–æ —Ç–µ–ª–µ—Å–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è.");
  if (passion>=4) parts.push("–î–∞–π –ø–æ–Ω—è—Ç—å –ø—Ä–æ <b>–∂–µ–ª–∞–Ω–∏–µ</b>: –≤–∑–≥–ª—è–¥, –ø—Ä–∏–∫–æ—Å–Ω–æ–≤–µ–Ω–∏—è, –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç, —É–≤–µ—Ä–µ–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞.");
  if (init>=4) parts.push("–í–æ–∑—å–º–∏ <b>–∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É</b> ‚Äî –ø—Ä–µ–¥–ª–æ–∂–∏ –ø–ª–∞–Ω –±–µ–∑ –ø–µ—Ä–µ–≥—Ä—É–∑–∞ –¥–µ—Ç–∞–ª—è–º–∏.");
  if (talk>=4) parts.push("–ë–æ–ª—å—à–µ <b>–∂–∏–≤–æ–≥–æ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞</b>: –∏–Ω—Ç–µ—Ä–µ—Å—É–π—Å—è –µ—ë –∏–¥–µ—è–º–∏, –∑–∞–¥–∞–≤–∞–π –æ—Ç–∫—Ä—ã—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã.");
  if (humor>=4) parts.push("–î–æ–±–∞–≤—å <b>–ª—ë–≥–∫–æ—Å—Ç–∏ –∏ —é–º–æ—Ä–∞</b>, –Ω–æ –±–µ–∑ –∫–æ–ª–∫–æ—Å—Ç–µ–π.");

  // –ï—Å–ª–∏ –Ω–∏–∑–∫–∏–µ
  if (passion<=2 && (ph==="–ú–µ–Ω—Å—Ç—Ä—É–∞–ª—å–Ω–∞—è" || ph==="–õ—é—Ç–µ–∏–Ω–æ–≤–∞—è")) {
    parts.push("–°—Ç—Ä–∞—Å—Ç—å —É–±–µ—Ä–∏ –Ω–∞ –∑–∞–¥–Ω–∏–π –ø–ª–∞–Ω ‚Äî <b>–∫–æ–º—Ñ–æ—Ä—Ç –≤–∞–∂–Ω–µ–µ</b>.");
  }
  if (talk<=2) parts.push("–ù–µ –ø–µ—Ä–µ–≥–æ–≤–∞—Ä–∏–≤–∞–π ‚Äî <b>–∫–æ—Ä–æ—á–µ –∏ —Ç–µ–ø–ª–µ–µ</b>.");

  // –§–∏–Ω–∏—à
  parts.push("–ì–ª–∞–≤–Ω–æ–µ: <b>—Å–æ–≥–ª–∞—Å–∏–µ –∏ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å</b> ‚Äî —Å–ø—Ä–æ—Å–∏, —á—Ç–æ –µ–π —Å–µ–π—á–∞—Å –ø—Ä–∞–≤–¥–∞ –Ω—É–∂–Ω–æ.");
  return parts.join(" ");
}

/* ====== –ü–£–õ –î–ï–ô–°–¢–í–ò–ô (–ø–µ—Ä–µ–º–µ—à–∏–≤–∞–µ—Ç—Å—è –∏ –≤—ã–¥–∞—ë—Ç—Å—è –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–æ–≤) ====== */
const actionsPoolBase = {
  common: [
    "–°–ø—Ä–æ—Å–∏ ¬´—á—Ç–æ —Ç–µ–±—è —Å–µ–π—á–∞—Å –ø–æ–¥–¥–µ—Ä–∂–∏—Ç?¬ª –∏ —Å–¥–µ–ª–∞–π —ç—Ç–æ",
    "–°–¥–µ–ª–∞–π –µ—ë –ª—é–±–∏–º—ã–π –Ω–∞–ø–∏—Ç–æ–∫ –¥–æ–º–∞",
    "–ù–µ–±–æ–ª—å—à–∞—è –∑–∞–ø–∏—Å–∫–∞ —Å —Ç—ë–ø–ª–æ–π –º—ã—Å–ª—å—é –≤ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–º –º–µ—Å—Ç–µ",
    "–ò—Å–∫—Ä–µ–Ω–Ω–∏–π –≥–æ–ª–æ—Å–æ–≤–æ–π –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç –Ω–∞ 20‚Äì30 —Å–µ–∫—É–Ω–¥",
    "–û—Ä–≥–∞–Ω–∏–∑—É–π —Ç–∏—Ö—É—é –ø—Ä–æ–≥—É–ª–∫—É –≤ –ø—Ä–∏—è—Ç–Ω–æ–º –º–µ—Å—Ç–µ",
    "–ü–æ—Å—Ç–∞–≤—å —Ç–∞–π–º–µ—Ä –Ω–∞ 10 –º–∏–Ω—É—Ç –∏ –ø—Ä–æ—Å—Ç–æ —Å–ª—É—à–∞–π –µ—ë –±–µ–∑ —Å–æ–≤–µ—Ç–æ–≤",
    "–°–æ–±–µ—Ä–∏ –ø–ª–µ–π–ª–∏—Å—Ç ¬´–Ω–∞—à —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –≤–∞–π–±¬ª",
    "–ü–æ–¥—Ö–≤–∞—Ç–∏ –æ–¥–∏–Ω –±—ã—Ç–æ–≤–æ–π –ø—É–Ω–∫—Ç –±–µ–∑ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π",
    "–ù–µ–±–æ–ª—å—à–æ–π —Å—é—Ä–ø—Ä–∏–∑-–ª–∞–∫–æ–º—Å—Ç–≤–æ –∫ —á–∞—é",
    "–ü—Ä–µ–¥–ª–æ–∂–∏ –≤–º–µ—Å—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å 1 —Å–µ—Ä–∏—é —á–µ–≥–æ-—Ç–æ –ª—ë–≥–∫–æ–≥–æ"
  ],
  care: [
    "–ü–æ–¥–æ–≥—Ä–µ–π –ø–ª–µ–¥, –∑–∞–∫–∞–∂–∏/–ø—Ä–∏–≥–æ—Ç–æ–≤—å —Å—É–ø –∏–ª–∏ —Ç—ë–ø–ª—ã–π —á–∞–π",
    "–í–æ–∑—å–º–∏ –Ω–∞ —Å–µ–±—è –º—É—Å–æ—Ä/–ø–æ—Å—É–¥—É/—Å—Ç–∏—Ä–∫—É —Å–µ–≥–æ–¥–Ω—è",
    "–ü–æ–¥–≥–æ—Ç–æ–≤—å —Ç—ë–ø–ª—É—é –≤–∞–Ω–Ω—É/–¥—É—à, –ø–æ—Å—Ç–∞–≤—å –ø–æ–ª–æ—Ç–µ–Ω—Ü–µ –∏ –ø–∏–∂–∞–º—É",
    "–°–æ–±–µ—Ä–∏ ¬´–∫–æ–º—Ñ–æ—Ä—Ç-–±–æ–∫—Å¬ª: –≤–æ–¥–∞, –≤–∫—É—Å–Ω—è—à–∫–∞, –≥—Ä–µ–ª–∫–∞",
    "–°–¥–µ–ª–∞–π –º–∏–Ω–∏-—Ä–µ–ª–∞–∫—Å: –∞—Ä–æ–º–∞–¥–∏—Ñ—Ñ—É–∑–æ—Ä, –ø—Ä–∏–≥–ª—É—à—ë–Ω–Ω—ã–π —Å–≤–µ—Ç"
  ],
  tenderness: [
    "–°–ø—Ä–æ—Å–∏—Ç—å ¬´–º–æ–∂–Ω–æ –æ–±–Ω–∏–º—É?¬ª –∏ –ø—Ä–æ—Å—Ç–æ –æ–±–Ω—è—Ç—å 60‚Äì90 —Å–µ–∫—É–Ω–¥",
    "–ú–∞—Å—Å–∞–∂ —à–µ–∏ –∏ –ø–ª–µ—á 5‚Äì7 –º–∏–Ω—É—Ç",
    "–ü–æ–≥–ª–∞–¥–∏—Ç—å –ø–æ —Å–ø–∏–Ω–µ/–≤–æ–ª–æ—Å–∞–º, –µ—Å–ª–∏ –µ–π —ç—Ç–æ –æ–∫",
    "–î–µ—Ä–∂–∞—Ç—å—Å—è –∑–∞ —Ä—É–∫–∏ –≤–æ –≤—Ä–µ–º—è –ø—Ä–æ–≥—É–ª–∫–∏",
    "–°–µ—Å—Ç—å —Ä—è–¥–æ–º –∏ —Å–º–æ—Ç—Ä–µ—Ç—å —Ñ–∏–ª—å–º –ø–æ–¥ –ø–ª–µ–¥–æ–º"
  ],
  passion: [
    "–ü—Ä—è–º–æ–π –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç –≤–Ω–µ—à–Ω–æ—Å—Ç–∏ + —É–≤–µ—Ä–µ–Ω–Ω—ã–π –≤–∑–≥–ª—è–¥",
    "–õ—ë–≥–∫–∏–π —Ñ–ª–∏—Ä—Ç-—Å–æ–æ–±—â–µ–Ω–∏–µ –¥–Ω—ë–º –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –≤–µ—á–µ—Ä–∞",
    "–ü–æ—Ü–µ–ª—É–π —á—É—Ç—å –¥–æ–ª—å—à–µ –æ–±—ã—á–Ω–æ–≥–æ –∏ ¬´—è —Ö–æ—á—É —Ç–µ–±—è¬ª",
    "–ó–∞–ø–ª–∞–Ω–∏—Ä—É–π —Å–≤–∏–¥–∞–Ω–∏–µ: —É–∂–∏–Ω –¥–æ–º–∞ –∏ –º—É–∑—ã–∫–∞",
    "–ü—Ä–µ–¥–ª–æ–∂–∏ —Å–æ–≤–º–µ—Å—Ç–Ω—ã–π –¥—É—à/–≤–∞–Ω–Ω—É (–µ—Å–ª–∏ –µ–π –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ)"
  ],
  initiative: [
    "–ü—Ä–µ–¥–ª–æ–∂–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–ª–∞–Ω –Ω–∞ –≤–µ—á–µ—Ä (–≤ 1‚Äì2 —à–∞–≥–∞)",
    "–ö—É–ø–∏ –±–∏–ª–µ—Ç—ã/–∑–∞–±—Ä–æ–Ω–∏—Ä—É–π —Å—Ç–æ–ª –±–µ–∑ –¥–æ–ª–≥–∏—Ö –æ–±—Å—É–∂–¥–µ–Ω–∏–π",
    "–°–æ—Å—Ç–∞–≤—å –º–∏–Ω–∏-–ª–∏—Å—Ç –¥–µ–ª –∏ –∑–∞–∫—Ä–æ–π 1‚Äì2 –∑–∞–¥–∞—á–∏",
    "–ü—Ä–µ–¥–ª–æ–∂–∏ –Ω–æ–≤—É—é –ª–æ–∫–∞—Ü–∏—é: –∫–∞—Ñ–µ/–ø–∞—Ä–∫/–º–∞—Ä—à—Ä—É—Ç",
    "–û—Ä–≥–∞–Ω–∏–∑—É–π –Ω–∞—Å—Ç–æ–ª—å–Ω—É—é –∏–≥—Ä—É/–Ω–µ–±–æ–ª—å—à–æ–π –∫–≤–µ—Å—Ç –¥–æ–º–∞"
  ],
  humor: [
    "–õ—ë–≥–∫–∞—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —à—É—Ç–∫–∞, –ø–æ–Ω—è—Ç–Ω–∞—è —Ç–æ–ª—å–∫–æ –≤–∞–º –¥–≤–æ–∏–º",
    "–ü–æ–¥–±–æ—Ä–∫–∞ —Å–º–µ—à–Ω—ã—Ö –∫–æ—Ä–æ—Ç–∫–∏—Ö –≤–∏–¥–µ–æ –Ω–∞ 5 –º–∏–Ω—É—Ç",
    "–ú–∏–Ω–∏-–∏–≥—Ä–∞: ¬´—É–≥–∞–¥–∞–π —Ñ–∞–∫—Ç¬ª –ø—Ä–æ –≤–∞—Å –¥–≤–æ–∏—Ö",
    "–ó–∞–±–∞–≤–Ω—ã–π —Å—Ç–∏–∫–µ—Ä/–º–µ–º —Å –ø–æ–¥–ø–∏—Å—å—é-–∫–æ–º–ø–ª–∏–º–µ–Ω—Ç–æ–º",
    "–°—ã–≥—Ä–∞–π—Ç–µ ¬´–¥–∞/–Ω–µ—Ç¬ª –Ω–∞ —Å–º–µ—à–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã"
  ],
  gifts: [
    "–ö—É–ø–∏—Ç—å —Ü–≤–µ—Ç—ã (—Å–∫—Ä–æ–º–Ω—ã–π –±—É–∫–µ—Ç –ø–æ –µ—ë –≤–∫—É—Å—É)",
    "–ü—Ä–∏–Ω–µ—Å—Ç–∏ –µ—ë –ª—é–±–∏–º—ã–π –¥–µ—Å–µ—Ä—Ç/—Ñ—Ä—É–∫—Ç",
    "–ú–∞–ª–µ–Ω—å–∫–∞—è –ø–æ–ª–µ–∑–Ω–∞—è —à—Ç—É–∫–∞, –æ –∫–æ—Ç–æ—Ä–æ–π –æ–Ω–∞ —É–ø–æ–º–∏–Ω–∞–ª–∞",
    "–ú–∏–ª—ã–π –º–∞–≥–Ω–∏—Ç/–Ω–∞–∫–ª–µ–π–∫–∞/–±—Ä–µ–ª–æ–∫ —Å –≤–∞—à–∏–º ¬´–∏–Ω—Å–∞–π–¥–æ–º¬ª",
    "–û—Ç–∫—Ä—ã—Ç–∫–∞ —Å –æ–¥–Ω–æ–π —Ç—ë–ø–ª–æ–π —Ñ—Ä–∞–∑–æ–π –æ—Ç —Ç–µ–±—è"
  ]
};

/* ====== –•–†–ê–ù–ï–ù–ò–ï –ò –ù–ï–ü–û–í–¢–û–†–ï–ù–ò–ï ====== */
function shuffle(arr){ return arr.map(v=>[v,Math.random()]).sort((a,b)=>a[1]-b[1]).map(([v])=>v); }

function getActionQueueKey(day){ return `cc_queue_day_${day}`; }
function loadQueue(day){
  const key = getActionQueueKey(day);
  const str = localStorage.getItem(key);
  if(!str) return [];
  try{ return JSON.parse(str); }catch{ return []; }

}
function saveQueue(day, queue){
  localStorage.setItem(getActionQueueKey(day), JSON.stringify(queue));

}
function buildActionPoolFor(scores){
  const [talk, care, hug, passion, init, humor] = scores;
  let pool = [...actionsPoolBase.common];
  if (care>=4) pool = pool.concat(actionsPoolBase.care);
  if (hug>=4) pool = pool.concat(actionsPoolBase.tenderness);
  if (passion>=4) pool = pool.concat(actionsPoolBase.passion);
  if (init>=4) pool = pool.concat(actionsPoolBase.initiative);
  if (humor>=4) pool = pool.concat(actionsPoolBase.humor);
  // –í—Ä–µ–º—è –æ—Ç –≤—Ä–µ–º–µ–Ω–∏ –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–∞—Ä–∫–∏: –ø—Ä–∏ —Å—Ç—Ä–∞—Å—Ç–∏ –∏–ª–∏ –ª—é—Ç–µ–∏–Ω/–ü–ú–° —ç—Ç–æ –∑–∞—Ö–æ–¥–∏—Ç –º—è–≥–∫–æ
  if (passion>=4 || care>=4) pool = pool.concat(actionsPoolBase.gifts);
  // –£–¥–∞–ª–∏–º –¥—É–±–ª–∏–∫–∞—Ç—ã
  pool = Array.from(new Set(pool));
  return pool;
}
function nextAction(day, scores, lock=false){
  let queue = loadQueue(day);
  // –µ—Å–ª–∏ –æ—á–µ—Ä–µ–¥—å –ø—É—Å—Ç–∞ –∏–ª–∏ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç–µ–∫—É—â–µ–º—É –ø—É–ª—É ‚Äî —Å—Ç—Ä–æ–∏–º –∑–∞–Ω–æ–≤–æ
  const pool = buildActionPoolFor(scores);
  if (!queue.length || !queue.every(a=>pool.includes(a))){
    queue = shuffle(pool);
  }
  const action = queue.shift();
  if (lock) {
    // –ï—Å–ª–∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–ª–∏ ‚Äî –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –≤ –æ—á–µ—Ä–µ–¥—å
    saveQueue(day, queue);
  } else {
    // –ü–æ–º–µ—Å—Ç–∏–º –¥–µ–π—Å—Ç–≤–∏–µ –≤ –∫–æ–Ω–µ—Ü, —á—Ç–æ–±—ã –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–ª–æ—Å—å —á–∞—Å—Ç–æ
    queue.push(action);
    saveQueue(day, queue);
  }
  return action;
}

/* ====== UI –û–¢–†–ò–°–û–í–ö–ê ====== */
const grid = document.getElementById('metricsGrid');
const output = document.getElementById('output');
const phaseChip = document.getElementById('phaseChip');
const vibeChip  = document.getElementById('vibeChip');
const adviceText = document.getElementById('adviceText');
const actionText = document.getElementById('actionText');

function renderBars(score, tone){
  const wrap = document.createElement('div'); wrap.className='bars';
  for(let i=1;i<=5;i++){
    const b = document.createElement('div'); b.className='bar';
    if (i<=score){ b.classList.add('on'); if(tone) b.classList.add(tone); }
    wrap.appendChild(b);
  }
  return wrap;
}
function toneForMetric(name){
  if (name==="–°—Ç—Ä–∞—Å—Ç—å") return 'love';
  if (name==="–ó–∞–±–æ—Ç–∞") return 'good';
  if (name==="–Æ–º–æ—Ä") return 'warn';
  return '';
}
function renderDay(day){
  const d = Number(day);
  if (!(d>=1 && d<=28)) return;
  const scores = table[d];
  grid.innerHTML = '';
  metricNames.forEach((name, idx)=>{
    const m = document.createElement('div'); m.className='metric';
    const h = document.createElement('h3');
    const hint = metricHints[name] || '';
    h.innerHTML = `<span title="${hint}">${name}</span> <span class="score" aria-label="–æ—Ü–µ–Ω–∫–∞">${scores[idx]}/5</span>`;
    m.appendChild(h);
    m.appendChild(renderBars(scores[idx], toneForMetric(name)));
    grid.appendChild(m);

  localStorage.setItem("cycleDay",d);
  localStorage.setItem("savedAt",Date.now());

  });

  const [phase, vibe] = phaseForDay(d);
  phaseChip.textContent = `–§–∞–∑–∞: ${phase}`;
  vibeChip.textContent  = `–í–∞–π–±: ${vibe}`;

  adviceText.innerHTML = adviceFor(d, scores);
  actionText.textContent = nextAction(d, scores, true); // –∑–∞—Ñ–∏–∫—Å–∏—Ä—É–µ–º –ø–µ—Ä–≤—É—é —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é
  output.hidden = false;
}

/* ====== –°–í–Ø–ó–ö–ê –ö–ù–û–ü–û–ö ====== */
document.getElementById('apply').addEventListener('click', ()=>{
  const day = document.getElementById('day').value;
  renderDay(day);
});
document.getElementById('shuffle').addEventListener('click', ()=>{
  // –û–±–Ω–æ–≤–∏–º —Ç–æ–ª—å–∫–æ –¥–µ–π—Å—Ç–≤–∏–µ, –Ω–µ –º–µ–Ω—è—è –æ—Å—Ç–∞–ª—å–Ω–æ–≥–æ
  const day = Number(document.getElementById('day').value);
  if (!(day>=1 && day<=28)) return;
  actionText.textContent = nextAction(day, table[day]);
});
document.getElementById('another').addEventListener('click', ()=>{
  const day = Number(document.getElementById('day').value);
  actionText.textContent = nextAction(day, table[day]);
});
document.getElementById('lock').addEventListener('click', ()=>{
  // –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å = –æ–±–Ω–æ–≤–∏—Ç—å –æ—á–µ—Ä–µ–¥—å (—Å–¥–≤–∏–Ω—É–ª–∏ —É–∂–µ –ø—Ä–∏ –ø–æ–∫–∞–∑–µ), –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
  const btn = document.getElementById('lock');
  btn.textContent = '–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ ‚úÖ';
  setTimeout(()=> btn.textContent = '–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å', 1200);
});




// –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–Ω—è
window.onload=()=>{
  if(localStorage.getItem("dark")==="true") document.body.classList.add("dark");
  const saved=localStorage.getItem("cycleDay"), at=localStorage.getItem("savedAt");
  if(saved&&at){
    const daysPassed=Math.floor((Date.now()-at)/(1000*60*60*24));
    let newDay=(+saved+daysPassed)%28; if(newDay===0)newDay=28;
    day.value=newDay; 
// –∞–≤—Ç–æ-—Ä–µ–Ω–¥–µ—Ä –¥–Ω—è 1 –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏
renderDay(newDay);
  } else {
// –∞–≤—Ç–æ-—Ä–µ–Ω–¥–µ—Ä –¥–Ω—è 1 –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏
renderDay(1);
}

};

const day=document.getElementById("day"),metrics=document.getElementById("metrics"),phaseEl=document.getElementById("phase"),vibe=document.getElementById("vibe"),advice=document.getElementById("advice"),action=document.getElementById("action");

</script>
  <script>
  const input = document.getElementById("day");
  const plusBtn = document.getElementById("plusDay");
  const minusBtn = document.getElementById("minusDay");

  plusBtn.addEventListener("click", () => {
    let val = parseInt(input.value) || 1;
    if (val < 28) {
      input.value = val + 1;
    } else {
      input.value = 1; // –∑–∞—Ü–∏–∫–ª–∏–≤–∞–µ–º —Ü–∏–∫–ª
    }
return false;
  });

  minusBtn.addEventListener("click", () => {
    let val = parseInt(input.value) || 1;
    if (val > 1) {
      input.value = val - 1;
    } else {
      input.value = 28; // –∑–∞—Ü–∏–∫–ª–∏–≤–∞–µ–º –Ω–∞–∑–∞–¥
    } return false;
  });
</script>
</body>
</html>




